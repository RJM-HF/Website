<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CVE Monitor · HomeFortress</title>
<style>
  :root{--bg:#0b1220;--panel:#0f172a;--txt:#e5e7eb;--muted:#9aa4b2;--border:#1f2937}
  body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.5 ui-sans-serif,system-ui}
  .wrap{max-width:980px;margin:40px auto;padding:0 16px}
  .card{background:color-mix(in srgb,var(--panel) 88%, transparent);border:1px solid var(--border);border-radius:18px;padding:18px 20px;margin:14px 0}
  h1{margin:0 0 8px 0} .muted{color:var(--muted)} a{color:#8ddbf0;text-decoration:none}
  table{width:100%;border-collapse:collapse} th,td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top}
  .tags{display:flex;flex-wrap:wrap;gap:6px} .tag{border:1px solid var(--border);border-radius:10px;padding:.15rem .5rem;background:color-mix(in srgb,var(--panel) 94%, transparent);font-size:.85rem}
</style>
</head>
<body>
<div class="wrap">
  <h1>CVE Monitor</h1>
  <p class="muted">Signals from CISA KEV and NVD for products we use.</p>

  <div id="kev" class="card"><strong>CISA Known Exploited Vulnerabilities</strong><div class="muted">Loading…</div></div>
  <div id="nvd" class="card"><strong>NVD Recent CVEs (filtered)</strong><div class="muted">Loading…</div></div>
</div>

<script>
(async function () {
  // PRODUCTS to watch (tune this to your stack)
  const WATCH_TERMS = [
    'Microsoft 365', 'Exchange Online', 'Outlook', 'Azure',
    'Cloudflare', 'Caddy', 'MikroTik', 'RouterOS', 'OpenSSL', 'Debian'
  ];

  // --- CISA KEV ---
  try {
    const kevUrl = 'https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json';
    const r = await fetch(kevUrl, {cache:'no-store'});
    const data = await r.json();
    const list = (data.vulnerabilities || [])
      .filter(v => WATCH_TERMS.some(t => (v.vendorProject+v.product).toLowerCase().includes(t.toLowerCase())))
      .slice(0, 25);

    const rows = list.map(v => `
      <tr>
        <td><a href="https://nvd.nist.gov/vuln/detail/${v.cveID}" target="_blank" rel="noopener">${v.cveID}</a><br>
          <span class="muted">${v.vendorProject} — ${v.product}</span></td>
        <td>${v.dueDate || ''}<br><span class="muted">${v.vulnerabilityName||''}</span></td>
        <td class="muted">${v.requiredAction||''}</td>
      </tr>`).join('');

    document.getElementById('kev').innerHTML =
      `<strong>CISA Known Exploited Vulnerabilities</strong>
       <table><thead><tr><th>CVE</th><th>Summary</th><th>Action</th></tr></thead><tbody>${rows || '<tr><td colspan="3">None matched.</td></tr>'}</tbody></table>`;
  } catch (e) {
    document.getElementById('kev').innerHTML = `<strong>CISA KEV</strong><div class="muted">Couldn’t load KEV feed.</div>`;
  }

  // --- NVD CVEs (last 90 days) ---
  // Optional: add ?apiKey=YOUR_NVD_KEY to raise rate limits.
  try {
    const since = new Date(Date.now() - 90*24*3600*1000).toISOString();
    const q = encodeURIComponent(WATCH_TERMS.join(' OR '));
    const nvdUrl = `https://services.nvd.nist.gov/rest/json/cves/2.0?pubStartDate=${since}&keywordSearch=${q}&noRejected`;
    const r = await fetch(nvdUrl, {cache:'no-store'});
    const data = await r.json();
    const items = (data.vulnerabilities || []).slice(0, 50);

    const rows = items.map(x => {
      const c = x.cve;
      const id = c.id;
      const desc = (c.descriptions||[])[0]?.value || '';
      const cvss = c.metrics?.cvssMetricV31?.[0]?.cvssData?.baseScore
                || c.metrics?.cvssMetricV30?.[0]?.cvssData?.baseScore
                || c.metrics?.cvssMetricV2?.[0]?.baseScore || '—';
      return `<tr>
        <td><a href="https://nvd.nist.gov/vuln/detail/${id}" target="_blank" rel="noopener">${id}</a></td>
        <td>${desc}</td>
        <td>${cvss}</td>
      </tr>`;
    }).join('');

    document.getElementById('nvd').innerHTML =
      `<strong>NVD Recent CVEs (filtered)</strong>
       <div class="muted">Query: ${WATCH_TERMS.join(', ')}</div>
       <table><thead><tr><th>CVE</th><th>Description</th><th>CVSS</th></tr></thead><tbody>${rows || '<tr><td colspan="3">No results.</td></tr>'}</tbody></table>`;
  } catch (e) {
    document.getElementById('nvd').innerHTML = `<strong>NVD Recent CVEs</strong><div class="muted">Couldn’t load NVD (rate limit or CORS). You can add an NVD API key via <code>?apiKey=XYZ</code>.</div>`;
  }
})();
</script>
</body>
</html>
